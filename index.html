<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Empty Legs</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 16px; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 12px; margin: 12px 0; }
    .title { font-weight: 700; margin-bottom: 6px; }
    .meta { color: #444; margin: 6px 0; }
    a.btn { display:inline-block; padding:10px 12px; border:1px solid #111; border-radius:8px; text-decoration:none; }
  </style>
</head>
<body>
  <h1>Live Empty Legs</h1>
  <p>Updated from Villiers feed.</p>

  <div id="list">Loading…</div>

  <script>
    // Many RSS feeds block direct browser access (CORS), so we use a public RSS->JSON helper.
    // If this helper ever rate-limits you, we can switch to a different free method.
    const rssUrl = "https://api.villiers.ai/feeds/empty-legs?id=8156";
    const api = "https://api.rss2json.com/v1/api.json?rss_url=" + encodeURIComponent(rssUrl);

    function stripHtml(html) {
      const div = document.createElement("div");
      div.innerHTML = html || "";
      return (div.textContent || div.innerText || "").trim();
    }

    fetch(api)
      .then(r => r.json())
      .then(data => {
        const list = document.getElementById("list");
        if (!data.items || !data.items.length) {
          list.innerHTML = "<p>No empty legs found right now.</p>";
          return;
        }
        list.innerHTML = data.items.map(item => {
          const title = stripHtml(item.title);
          const desc = stripHtml(item.description).slice(0, 220);
          const link = item.link; // should already include your affiliate tracking
          return `
            <div class="card">
              <div class="title">${title}</div>
              <div class="meta">${desc}${desc.length >= 220 ? "…" : ""}</div>
              <a class="btn" href="${link}" target="_blank" rel="noopener">View / Book</a>
            </div>
          `;
        }).join("");
      })
      .catch(err => {
        document.getElementById("list").innerHTML =
          "<p>Couldn’t load the feed yet. Double-check your RSS link.</p>";
        console.error(err);
      });
  </script>
</body>
</html>
